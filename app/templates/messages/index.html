{% extends 'base.html' %}
{% block title %}Messages · TrackYourSheets{% endblock %}
{% block content %}
<div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center mb-4 gap-3">
  <div>
    <h1 class="h3 mb-1">Private &amp; group messages</h1>
    <p class="text-muted mb-0">Collaborate with teammates across offices without leaving TrackYourSheets. Conversations respect organisation roles.</p>
  </div>
  <a class="btn btn-outline-secondary" href="{{ url_for('main.dashboard') }}">Back to dashboard</a>
</div>

<div class="row g-4">
  <div class="col-lg-7">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-light d-flex justify-content-between align-items-center">
        <h2 class="h6 mb-0">Your conversations</h2>
        <span class="badge bg-primary-soft text-primary">{{ threads|length }} active</span>
      </div>
      <div class="list-group list-group-flush">
        {% for thread in threads %}
        <a class="list-group-item list-group-item-action" href="{{ url_for('main.view_message_thread', thread_id=thread.id) }}">
          <div class="d-flex justify-content-between align-items-start gap-3">
            <div>
              <div class="fw-semibold">{{ thread.name }}</div>
              <div class="text-muted small">Participants: {{ thread.display_participants | join(', ') }}</div>
              {% if thread.preview %}
              <div class="text-muted small mt-1">{{ thread.preview.author }}: {{ thread.preview.body }}</div>
              {% endif %}
            </div>
            <span class="badge {{ 'bg-primary-soft text-primary' if thread.is_group else 'bg-secondary-soft text-secondary' }}">{{ 'Group' if thread.is_group else 'Direct' }}</span>
          </div>
        </a>
        {% else %}
        <div class="list-group-item text-center text-muted py-4">No messages yet. Start a conversation on the right.</div>
        {% endfor %}
      </div>
    </div>
  </div>
  <div class="col-lg-5">
    <div class="card shadow-sm">
      <div class="card-header bg-light">
        <h2 class="h6 mb-0">Start a new conversation</h2>
      </div>
      <form method="post">
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label">Name (optional)</label>
            <input type="text" name="name" class="form-control" placeholder="Team huddle, Client follow-up, …">
            <div class="form-text">We’ll auto-name the conversation if you leave this blank.</div>
          </div>
          <div class="mb-3">
            <label class="form-label">Participants</label>
            <select name="participants" class="form-select" multiple size="6" required>
              {% for teammate in teammates %}
              <option value="{{ teammate.id }}">{{ teammate.display_name_for_ui }} ({{ teammate.email }})</option>
              {% endfor %}
            </select>
            <div class="form-text">You’re included automatically. Select one teammate for a private chat or several for a group.</div>
          </div>
          <div class="mb-0">
            <label class="form-label">Kick-off message (optional)</label>
            <textarea name="message" rows="3" class="form-control" placeholder="Welcome or agenda…"></textarea>
          </div>
        </div>
        <div class="card-footer bg-light d-flex justify-content-between align-items-center">
          <span class="text-muted small">Messages respect HR and admin access rules.</span>
          <button type="submit" class="btn btn-primary">Create</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
